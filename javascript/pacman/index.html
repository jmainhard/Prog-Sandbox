<!DOCTYPE html>
<html lang="en">

<head>
    <!-- 8-07-2021 Clase JS, juego con js -->
    <!-- 9-07-2021 -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Pacman Fruna | (pero no tanto)</title>
</head>

<body>
    <div id="map"></div>
    <div id="pacman"></div>
    <div id="pacman-cc" style="font-family: sans-serif;"></div>

    <script>
        function DivObject(id) {
            this.html = document.getElementById(id);
            this.x = document.getElementById(id).getBoundingClientRect().x;
            this.y = document.getElementById(id).getBoundingClientRect().y;
            this.height = document.getElementById(id).getBoundingClientRect().height;
            this.width = document.getElementById(id).getBoundingClientRect().width;
            this.speed = 5;
            this.canMove = {
                right: true,
                left: true,
                up: true,
                down: true
            };
            this.moveRight = function () {
                this.x += this.speed;
                this.html.style.left = this.x + 'px';
            };
            this.moveLeft = function () {
                this.x -= this.speed;
                this.html.style.left = this.x + 'px';
            };
            this.moveUp = function () {
                this.y -= this.speed;
                this.html.style.top = this.y + 'px';
            };
            this.moveDown = function () {
                this.y += this.speed;
                this.html.style.top = this.y + 'px';
            };
            this.isCollide = function (obj) {
                let aRect = a.getBoundingClientRect();
                let bRect = b.getBoundingClientRect();
                return !(
                    ((aRect.top + aRect.height) < (bRect.top)) ||
                    (aRect.top > (bRect.top + bRect.height)) ||
                    ((aRect.left + aRect.width) < bRect.left) ||
                    (aRect.left > (bRect.left + bRect.width))
                );
            };
            this.leftCollide = function (obj) {
                for (let i = 0; i < obj.length; i++) {
                    if (this.isCollide(blocks[i])) {
                        blocks[i].setAttribute('style', 'background-color: red;');
                    }
                }
                if (checkSide('left', this.html, obj)) {
                    obj.setAttribute('style', 'background-color: red;');
                }
            }
        }

        /* 0 - vacio (empty)
         * 1 - bloque (block)
         * 2 - moneda (coin)
         * 3 - pacman  (pacman)
         * 4 - fantasma (ghost)
        */
        var map = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 2, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 3, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];

        function drawMap() {
            let output = '';
            for (let i = 0; i < map.length; i++) {
                output += '<div class="row">\n';
                for (let j = 0; j < map[i].length; j++) {
                    if (map[i][j] === 0) {
                        output += '\t<div class="empty"></div>\n';
                    } else if (map[i][j] === 1) {
                        output += '\t<div class="block"></div>\n';
                    } else if (map[i][j] === 2) {
                        output += '\t<div class="coin"></div>\n';
                    } else if (map[i][j] === 3) {
                        output += '\t<div class="pacman"></div>\n';
                    }
                }
                output += '</div>\n';
            }
            document.getElementById('map').innerHTML = output;
        }

        function drawCoordinates(x, y) {
            document.getElementById('pacman-cc').innerHTML = 'X: ' + x + '<br>' + 'Y: ' + y;
        }
        drawCoordinates('undefined', 'undefined');

        document.addEventListener('keydown', function (event) {
            let pacman = new DivObject('pacman');
            if (event.code === 'ArrowRight') {
                pacman.moveRight();
            } else if (event.code === 'ArrowLeft') {
                pacman.moveLeft();
                if (pacman.leftCollide(document.getElementsByClassName('block'))) {
                    return console.log('Colisión 2');
                }
            } else if (event.code === 'ArrowUp') {
                pacman.moveUp();
            } else if (event.code === 'ArrowDown') {
                pacman.moveDown();
            }
            drawCoordinates(pacman.x, pacman.y);
        });

        function checkBlockCollissions(divObj) {
            let blocks = document.getElementsByClassName('block');
            for (let i = 0; i < blocks.length; i++) {
                if (divObj.isCollide(blocks[i])) {
                    console.log('Colisión detectada!');
                    blocks[i].setAttribute('style', 'background-color: red;');
                }
            }
        }

        /*
         * detector de colisiones basado en: https://en.wikipedia.org/wiki/Minimum_bounding_rectangle
         * fuente algoritmo: https://stackoverflow.com/questions/2440377
         * a y b: html elements
         * 
         * Colisión superior:   0
         * Colisión inferior:   1
         * Colisión derecha:    2
         * Colisión izquierda:  3
       */
        function checkSide(side, a, b) {
            return col
        }

        drawMap();
    </script>

</body>

</html>