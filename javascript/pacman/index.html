<!DOCTYPE html>
<html lang="en">

<head>
    <!-- 8-07-2021 Clase JS, juego con js -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Pacman Fruna | (pero no tanto)</title>
</head>

<body>
    <div id="map"></div>
    <div id="pacman"></div>

    <script>
        /* 0 - vacio (empty)
         * 1 - bloque (block)
         * 2 - moneda (coin)
         * 3 - pacman  (pacman)
         * 4 - fantasma (ghost)
        */

        function DivObject(id) {
            this.html = document.getElementById(id);
            this.x = document.getElementById(id).offsetLeft;
            this.y = document.getElementById(id).offsetTop;
            this.height = document.getElementById(id).offsetHeight;
            this.width = document.getElementById(id).offsetWidth;
            this.speed = 5;
            this.moveRight = function () {
                this.x += this.speed;
                this.html.style.left = this.x + 'px';
            };
            this.moveLeft = function () {
                this.x -= this.speed;
                this.html.style.left = this.x + 'px';
            };
            this.moveUp = function () {
                this.y -= this.speed;
                this.html.style.top = this.y + 'px';
            };
            this.moveDown = function () {
                this.y += this.speed;
                this.html.style.top = this.y + 'px';
            };
        }

        var map = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 2, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 3, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];

        function drawMap() {
            let output = '';
            for (let i = 0; i < map.length; i++) {
                output += '<div class="row">\n';
                for (let j = 0; j < map[i].length; j++) {
                    if (map[i][j] === 0) {
                        output += '\t<div class="empty"></div>\n';
                    } else if (map[i][j] === 1) {
                        output += '\t<div class="block"></div>\n';
                    } else if (map[i][j] === 2) {
                        output += '\t<div class="coin"></div>\n';
                    } else if (map[i][j] === 3) {
                        output += '\t<div class="pacman"></div>\n';
                    }
                }
                output += '</div>\n';
            }
            document.getElementById('map').innerHTML = output;
        }

        document.addEventListener('keydown', function (event) {
            let pacman = new DivObject('pacman');
            let collide = isCollideWithBlock(pacman);
            if (event.code === 'ArrowRight') {
                pacman.moveRight();
            } else if (event.code === 'ArrowLeft') {
                pacman.moveLeft();
            } else if (event.code === 'ArrowUp') {
                pacman.moveUp();
            } else if (event.code === 'ArrowDown') {
                pacman.moveDown();
            }
        });


        function isCollideWithBlock(obj) {
            let blocks = document.getElementsByClassName('block');
            for (let i = 0; i < blocks.length; i++) {
                let block = {
                    x: blocks[i].offsetLeft,
                    y: blocks[i].offsetTop,
                    height: blocks[i].offsetHeight,
                    width: blocks[i].offsetWidth
                };
                if (isCollide(block, obj)) {
                    // console.log(block);
                    // blocks[i].setAttribute('style', 'background-color: red;');
                    // console.log('Colisión detectada!');
                    switch (wallPosition(block, obj)) {
                        case value:
                            
                            break;
                    
                        default:
                            break;
                    }
                }
            }
        }

        /*
         * Colisión superior:   1
         * Colisión inferior:   2
         * Colisión derecha:    3
         * Colisión izquierda:  4
        */
        function wallPosition(a, b) {
            let posCode;
            if ( (a.y > (b.y + b.height)) ) {
                console.log('Parece que está arriba');
                posCode = 1;
            } else if ( ((a.y + a.height) < (b.y)) ) {
                console.log('Parece que está abajo');
                posCode = 2;
            } else if ( ((a.x + a.width) < b.x) ) {
                console.log('Parece que está a la derecha');
                posCode = 3;  
            } else if ( (a.x > (b.x + b.width)) ) {
                console.log('Parece que está a la izquierda');
                posCode = 4;  
            } 
            return posCode;
        }


        // detector de colisiones basado en: https://en.wikipedia.org/wiki/Minimum_bounding_rectangle
        // fuente algoritmo: https://stackoverflow.com/questions/2440377
        // a y b: dos objetos con coordenadas y tamaño
        // a: bloque 
        // b: pacman
        function isCollide(a, b) {
            return !(
                ((a.y + a.height) < (b.y)) ||
                (a.y > (b.y + b.height)) ||
                ((a.x + a.width) < b.x) ||
                (a.x > (b.x + b.width))
            );
        }

        drawMap();
    </script>

</body>

</html>